<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <script>
      // JavaScript 内部，所有数字都是以 64 位浮点数形式储存，即使整数也是如此
      // JavaScript 语言的底层根本没有整数，所有数字都是小数（64 位浮点数）
      // 某些运算只有整数才能完成，JavaScript 会自动把 64 位浮点数转成 32 位整数，然后再进行运算

      // 1 与 1.0 是相同的，是同一个数
      1 === 1.0; // true

      // 由于浮点数不是精确的值，所以涉及小数的比较和运算要特别小心
      /*
        0.1 + 0.2 === 0.3             // false
        0.3 / 0.1                     // 2.9999999999999996
        (0.3 - 0.2) === (0.2 - 0.1)   // false
      */

      // JavaScript 浮点数的 64 个二进制位，从最左边开始，是这样组成的
      // 第 1 位：符号位，0 表示正数，1 表示负数
      // 第 2 位到第 12 位（共 11 位）：指数部分
      // 第 13 位到第 64 位（共 52 位）：小数部分（即有效数字）
      // 符号位决定了一个数的正负，指数部分决定了数值的大小，小数部分决定了数值的精度

      // 指数部分一共有 11 个二进制位，因此大小范围就是 0 到 2047
      // 如果指数部分的值在 0 到 2047 之间（不含两个端点）
      // 那么有效数字的第一位默认总是 1，不保存在 64 位浮点数之中
      // 有效数字这时总是 1.xx...xx 的形式，xx..xx 部分保存在 64 位浮点数之中，最长可能为 52 位
      // 因此，JavaScript 提供的有效数字最长为 53 个二进制位
      // (-1)^符号位 * 1.xx...xx * 2^指数部分
      // 上面公式是正常情况下（指数部分在 0 到 2047 之间），一个数在 JavaScript 内部实际的表示形式

      // 精度最多只能到 53 个二进制位，所以绝对值小于 2 的 53 次方的整数，都可以精确表示
      Math.pow(2, 53); // 9007199254740992
      Math.pow(2, 53) + 1; // 9007199254740992
      Math.pow(2, 53) + 2; // 9007199254740994
      Math.pow(2, 53) + 3; // 9007199254740996
      Math.pow(2, 53) + 4; // 9007199254740996
      // 上面代码中，大于 2 的 53 次方以后，整数运算的结果开始出现错误
      // 大于 2 的 53 次方的数值，都无法保持精度

      // 由于 2 的 53 次方是一个 16 位的十进制数值
      // 所以简单的法则就是，JavaScript 对 15 位的十进制数都可以精确处理
      Math.pow(2, 53); // 9007199254740992
      // 多出的三个有效数字，将无法保存
      9007199254740992111; // 9007199254740992000
      // 大于 2 的 53 次方以后，多出来的有效数字（最后三位的 111）都会无法保存，变成 0

      // 64 位浮点数的指数部分的长度是 11 个二进制位，意味着指数部分的最大值是 2047
      // JavaScript 能够表示的数值范围为 2^1024 到 2^-1023（开区间），超出这个范围的数无法表示

      // 如果一个数大于等于 2 的 1024 次方，那么就会发生“正向溢出”
      // 即 JavaScript 无法表示这么大的数，这时就会返回 Infinity
      Math.pow(2, 1024); // Infinity

      // 如果一个数小于等于 2 的 -1075 次方（指数部分最小值 -1023，再加上小数部分的 52 位）
      // 那么就会发生为“负向溢出”，即 JavaScript 无法表示这么小的数，这时会直接返回 0
      Math.pow(2, -1075); // 0

      // Number 对象的 MAX_VALUE 和 MIN_VALUE 属性，返回可以表示的具体的最大值和最小值
      Number.MAX_VALUE; // 1.7976931348623157e+308
      Number.MIN_VALUE; // 5e-324
    </script>
  </body>
</html>
